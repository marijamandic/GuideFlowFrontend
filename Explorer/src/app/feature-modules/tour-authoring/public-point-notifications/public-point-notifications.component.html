<div class="notifications-container">
    <div class="header">
        <h4>Notifications</h4>
        <span class="mark-read-text" (click)="markAllAsRead()">Mark all as read</span>
    </div>

    <div class="header" *ngIf="unreadNotification.length === 0 && readNotificatio.length === 0">
        <p>No notifications available.</p>
    </div>

    <div class="notification-table scrollable">
        <ng-container *ngFor="let notification of combinedNotifications">
            <!-- Prikaz za Public Point Notification -->
            <div *ngIf="isPublicPointNotification(notification)" 
                 class="notification-row unread"
                 [ngClass]="{
                    accepted: notification.data.isAccepted,
                    rejected: !notification.data.isAccepted
                 }"
                 (click)="openNotificationDialog(notification.data)">
                <div class="notification-title">
                    <span>
                        <strong [ngClass]="{
                            'notification-point': !notification.isOpened,
                            'notification-point-read': notification.isOpened
                        }">{{ loadPublicPoint(notification.data.publicPointId) }}
                        </strong>
                    </span>
                    <div class="notification-comment">
                        {{ truncateComment(notification.data.comment || '', 100) }}
                    </div>
                    <div class="notification-date">
                        {{ notification.creationTime | date:'MMMM d, y, h:mm a' }}
                    </div>
                    <div class="notification-status"
                         [ngClass]="notification.data.isAccepted ? 'status-accepted' : 'status-rejected'">
                        {{ notification.data.isAccepted ? 'ACCEPTED' : 'REJECTED' }}
                    </div>
                </div>
            </div>
    
            <!-- Prikaz za običan Notification -->
            <div *ngIf="isNotification(notification)" class="notification-row unread">
                <!-- Type == 0   Problem Notification -->
                <div *ngIf="notification.data.type == 0" class="notification-title" (click)="problemButton(notification.data)">
                    <span>
                        <strong [ngClass]="{
                            'notification-point': !notification.isOpened,
                            'notification-point-read': notification.isOpened
                        }">Senter: {{ notification.data.sender }}
                        </strong>
                    </span>
                    <div class="notification-comment">
                        {{ truncateComment(notification.data.message || '', 100) }}
                    </div>
                    <div class="notification-date">
                        {{ notification.creationTime | date:'MMMM d, y, h:mm a' }}
                    </div>
                </div>
    
                <!-- Type == 1   Money Exchange -->
                <div *ngIf="notification.data.type == 1" class="notification-title" (click)="moneyButton(notification.data)">
                    <span>
                        <strong [ngClass]="{
                            'notification-point': !notification.isOpened,
                            'notification-point-read': notification.isOpened
                        }">Sender: {{ notification.data.sender }}
                        </strong>
                    </span>
                    <div class="notification-comment">
                        {{ truncateComment(notification.data.message || '', 100) }}
                    </div>
                    <div class="notification-date">
                        {{ notification.creationTime | date:'MMMM d, y, h:mm a' }}
                    </div>
                </div>
    
                <!-- Type == 2   ClubNotification -->
                <div *ngIf="notification.data.type == 2" class="notification-title" (click)="clubButton(notification.data)">
                    <span>
                        <strong [ngClass]="{
                            'notification-point': !notification.isOpened,
                            'notification-point-read': notification.isOpened
                        }">Club: {{ notification.data.sender }}
                        </strong>
                    </span>
                    <div class="notification-comment">
                        {{ truncateComment(notification.data.message || '', 100) }}
                    </div>
                    <div class="notification-date">
                        {{ notification.creationTime | date:'MMMM d, y, h:mm a' }}
                    </div>
                    <div class="notification-button">
                        <button class="cta-button button-decline">DECLINE</button>
                        <span class="vertical-line"></span>
                        <button class="cta-button button-accept">ACCEPT</button>
                    </div>
                </div>
    
                <!-- Type == 3   Message Notification -->
                <div *ngIf="notification.data.type == 3" class="notification-title" (click)="messageButton(notification.data)">
                    <span>
                        <strong [ngClass]="{
                            'notification-point': !notification.isOpened,
                            'notification-point-read': notification.isOpened
                        }">{{ notification.data.sender }} sent you a message
                        </strong>
                    </span>
                    <div class="notification-comment">
                        {{ truncateComment(notification.data.message || '', 100) }}
                    </div>
                    <div>
                        <a href="https://example.com" target="_blank" rel="noopener noreferrer" class="notification-link">
                            Click here for more details
                        </a>
                    </div>
                    <div class="notification-date">
                        {{ notification.creationTime | date:'MMMM d, y, h:mm a' }}
                    </div>                    
                </div>
            </div>
        </ng-container>
    </div>
    
    <!--
    <div class="notification-table">
        <ng-container *ngFor="let notification of combinedNotifications">
        <div *ngIf="isPublicPointNotification(notification)" 
                 class="notification-row read"
                 [ngClass]="{
                    accepted: notification.data.isAccepted,
                    rejected: !notification.data.isAccepted
                 }"
                 (click)="openNotificationDialog(notification.data)">
            <div class="notification-title">
                <strong class="notification-point-read">Public Point ID: {{ notification.data.publicPointId }}</strong>
                <div class="notification-comment">
                    {{ truncateComment(notification.data.comment, 100) }}
                </div>
                <div class="notification-date">{{ notification.data.creationTime | date:'MMMM d, y, h:mm a' }}</div>
                <div class="notification-status" [ngClass]="notification.data.isAccepted ? 'status-accepted' : 'status-rejected'">
                    {{ notification.data.isAccepted ? 'ACCEPTED' : 'REJECTED' }}
                </div>
            </div>
        </div>
        -->
        <!-- Prikaz za običan Notification 
        <div *ngIf="isNotification(notification)" 
        class="notification-row read">
        <div class="notification-title">
        <span>
            <strong class="notification-point-read">
                Sender: {{ notification.data.sender }}
            </strong>
        </span>
        <div class="notification-comment">
            {{ truncateComment(notification.data.message || '', 100) }}
        </div>
        <div class="notification-date">
            {{ notification.creationTime | date:'MMMM d, y, h:mm a' }}
        </div>
        </div>
        </div>
        </ng-container>
    </div>
    -->
    <div *ngIf="showModal" class="modal-backdrop">
        <div class="modal-content card">
            <div *ngIf="selectedPoint?.imageUrl">
                <img [src]="selectedPoint?.imageUrl" alt="Public Point Image" class="modal-image card-image"/>
            </div>
    
            <div class="card-details">
                <h2>{{ selectedPoint?.name }}</h2>
                <p>{{ selectedPoint?.description }}</p>
                <p><span class="label"></span>
                    <ng-container *ngIf="selectedPoint?.approvalStatus === 2">Rejected</ng-container>
                    <ng-container *ngIf="selectedPoint?.approvalStatus === 1">Accepted</ng-container>
                    <ng-container *ngIf="selectedPoint?.approvalStatus === 0">Pending</ng-container>
                    <ng-container *ngIf="selectedPoint?.approvalStatus === undefined">No status</ng-container>
                </p>
    
                <p><span class="label"></span> {{ selectedNotification?.comment }}</p>
                <p><span class="label"></span> {{ selectedNotification?.isAccepted ? 'Accepted' : 'Rejected' }}</p>
    
                <button class="close-button" (click)="closeModal()">X</button>
            </div>
        </div>
    </div>
    
</div>
