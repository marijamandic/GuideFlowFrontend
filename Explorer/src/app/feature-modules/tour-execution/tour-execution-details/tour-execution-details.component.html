<div *ngIf="tourExecution" class="tour-execution-card">
  <h2>Tour Execution Details</h2>
  <div class="tour-info">
      <p><strong>Tour Execution ID:</strong> {{ tourExecution.id }}</p>
      <p><strong>Tour ID:</strong> {{ tourExecution.tourId }}</p>
      <p><strong>User ID:</strong> {{ tourExecution.userId }}</p>
      <p><strong>Tour Range:</strong> {{ tourExecution.tourRange }} km</p>
      <p><strong>Start Time:</strong> {{ tourExecution.startTime | date: 'short' }}</p>
      <p><strong>End Time:</strong> {{ tourExecution.endTime | date: 'short' }}</p>
      <p><strong>Last Activity:</strong> {{ tourExecution.lastActivity | date: 'short' }}</p>
      <p><strong>Execution Status:</strong> {{ getExecutionStatusText() }}</p>
    </div>

  <h3>Checkpoints Status</h3>
  <div class="checkpoints-container">
      <div *ngFor="let checkpointStatus of tourExecution.checkpointsStatus" class="checkpoint-card">
          <p><strong>Checkpoint Status ID:</strong> {{ checkpointStatus.id }}</p>
          <p><strong>Checkpoint ID:</strong> {{ checkpointStatus.checkpointId }}</p>
          <p><strong>Completion Time:</strong> {{ checkpointStatus.completionTime | date: 'short' }}</p>

          <div class="checkpoint-details">
              <h4>Checkpoint Details</h4>
              <p><strong>Name:</strong> {{ checkpointStatus.checkpoint.name }}</p>
              <p><strong>Description:</strong> {{ checkpointStatus.checkpoint.description }}</p>
              <p><strong>Secret:</strong> {{ checkpointStatus.checkpoint.secret }}</p>
              <p><strong>Latitude:</strong> {{ checkpointStatus.checkpoint.latitude }}</p>
              <p><strong>Longitude:</strong> {{ checkpointStatus.checkpoint.longitude }}</p>
              <img [src]="getImagePath(checkpointStatus.checkpoint.imageUrl)" alt="Checkpoint Image" width="100" />
          </div>
      </div>
      <button 
        class="review-button" 
        (click)="openReviewForm()" 
        [disabled]="isDisabled()"
      >
        Ostavi recenziju
      </button>

      <p *ngIf="getReviewMessage()" class="expired-message">
        {{ getReviewMessage() }}
      </p>      
  </div>

  <div *ngIf="isReviewFormOpen" class="overlay">
    <div class="review-popup">
      <xp-tour-review 
        [tourId]="tourExecution?.tourId ?? 0"
        [touristId]="tourExecution?.userId ?? 0"
        [startDate]="tourExecution?.startTime ?? null"
        [percentageCompleted]="percentageCompleted ?? 0"
        (tourReviewUpdated)="closeReviewForm()"
      >
      </xp-tour-review>
      <button class="close-button" (click)="closeReviewForm()">X</button>
    </div>
  </div>
</div>
