<div class="main-container">
<!-- Mapa kao pozadina -->
<div class="map-background">
  <xp-tour-execution-map [checkpoints]="checkpointCoordinates"></xp-tour-execution-map>
</div>

<!-- Leva kolona - Informacije i Checkpoint Details sa skrolom -->
<div class="left-container">
  <!-- Osnovne informacije -->
  <div class="info-container">
    <h3>Tour Execution Details</h3>
    <div class="basicInfo">
      <p><strong>User Name:</strong> {{ tourist?.username }}</p>
      <p><strong>Tour Range:</strong> {{ tourExecution?.tourRange }} km</p>
      <p><strong>Execution Status:</strong> {{ mapToTourExecutionStatus(tourExecution?.executionStatus ?? 0) }}</p>
      <p><strong>Start Time:</strong> {{ tourExecution?.startTime | date: 'short' }}</p>
      <p><strong>Number of Checkpoints:</strong> {{ tourExecution?.checkpointsStatus?.length }}</p>
    </div>
  </div>


  <!-- Kartica za Checkpoint -->
  <div class="checkpoint-container">
    <div class="checkpoint-card">
      <div class="checkpoint-image-wrapper">
        <img [src]="getImagePath(currentCheckpoint.checkpoint.imageUrl)" alt="Checkpoint Image" class="checkpoint-image" />
      </div>
      <div class="checkpoint-header">
        <h3>{{ currentCheckpoint.checkpoint.name }}</h3>
      </div>
      <div class="checkpoint-info">
        <p><strong>Description:</strong> {{ currentCheckpoint.checkpoint.description }}</p>
        <p><strong>Completion Time:</strong> {{ mapToCompletionTime(currentCheckpoint.completionTime) }}</p>
        <p><strong>Secret:</strong> {{ currentCheckpoint.checkpoint.secret }}</p>
      </div>
      <button class="review-button" (click)="openReviewForm()" [disabled]="isDisabled()">Leave Review</button>
      <p *ngIf="getReviewMessage()" class="expired-message">
        {{ getReviewMessage() }}
        </p>
    </div>
    <div *ngIf="isReviewFormOpen" class="overlay">
      <div class="review-popup">
        <xp-tour-review 
          [tourId]="tourExecution?.tourId ?? 0"
          [touristId]="tourExecution?.userId ?? 0"
          [startDate]="tourExecution?.startTime ?? null"
          [percentageCompleted]="percentageCompleted ?? 0"
          (tourReviewUpdated)="closeReviewForm()"
        >
        </xp-tour-review>
        <button class="close-button" (click)="closeReviewForm()">X</button>
      </div>
    </div>
  </div>


  <!-- Dugmad za akcije -->
  <div class="button-container">
    <button class="button abandon-button" (click)="abandonSession()">Abandon Session</button>
    <button class="button complete-button" (click)="completeSession()">Complete Session</button>
  </div>
</div>


<!-- Kontejner za progres bar -->
<div class="progress-bar-container">
  <div class="progress-bar-wrapper">
    <div
      class="progress-bar"
      [style.width.%]="percentageCompleted"
      [class.low]="percentageCompleted < 35"
      [class.medium]="percentageCompleted >= 35 && percentageCompleted < 70"
      [class.high]="percentageCompleted >= 70">
    </div>
  </div>
  <p><strong>Progress:</strong> {{ percentageCompleted }}%</p>
</div>
</div>