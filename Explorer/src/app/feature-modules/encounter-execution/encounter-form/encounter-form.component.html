<div class="form-container">
  <form class="encounter-form">
    <h2>{{ encounter.id ? 'Edit Encounter' : 'Add Encounter' }}</h2>

    <!-- Dropdown za tip Encounter-a -->
    <div *ngIf="!encounter.id" class="form-group">
      <label for="encounterType">Encounter Type</label>
      <select id="encounterType" [(ngModel)]="encounter.encounterType" name="encounterType" (change)="onEncounterTypeChange()" [disabled]="!!encounter.id">
        <option value="Social">Social</option>
        <option value="Location">Hidden Location</option>
        <option value="Misc">Misc</option>
      </select>
    </div>

    <div *ngIf="encounter.id || typeSelected === true">
      <!-- Dodatna polja za specifične tipove -->
      <div *ngIf="encounter.encounterType === 0">
        <!-- Social Encounter -->
        <div class="form-group">
          <label for="touristNumber">Tourist Number</label>
          <input type="number" id="touristNumber" [(ngModel)]="encounter.touristNumber" name="touristNumber" required />
        </div>
        <div class="form-group">
          <label for="encounterRange">Encounter Range</label>
          <input type="number" id="encounterRange" [(ngModel)]="encounter.encounterRange" name="encounterRange" required />
        </div>
      </div>

      <div *ngIf="encounter.encounterType === 1">
        <!-- Hidden Location Encounter -->
        <div class="form-group">
          <label for="activationRange">Activation Range</label>
          <input type="number" id="activationRange" [(ngModel)]="encounter.activationRange" name="activationRange" />
        </div>
        <div class="form-group">
          <label for="checkpointId">Checkpoint Id</label>
          <input type="number" id="checkpointId" [(ngModel)]="encounter.checkpointId" name="checkpointId" />
        </div>
        <div class="form-group">
          <label for="fileInput">Image Upload</label>
          <input id="fileInput" type="file" (change)="onFileSelected($event)">
        </div>
        <!-- <div class="form-group">
          <label for="imageLatitude">Image Latitude</label>
          <input type="number" id="imageLatitude" [(ngModel)]="encounter.imageLatitude" name="imageLatitude" />
        </div>
        <div class="form-group">
          <label for="imageLongitude">Image Longitude</label>
          <input type="number" id="imageLongitude" [(ngModel)]="encounter.imageLongitude" name="imageLongitude" />
        </div> -->
      </div>

      <div *ngIf="encounter.encounterType === 2">
        <!-- Misc Encounter -->
        <div class="form-group">
          <label for="actionDescription">Action Description</label>
          <textarea id="actionDescription" [(ngModel)]="encounter.actionDescription" name="actionDescription" required></textarea>
        </div>
      </div>

      <!-- Osnovna polja -->
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" id="name" [(ngModel)]="encounter.name" name="name" required placeholder="Encounter name" />
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" [(ngModel)]="encounter.description" name="description" required placeholder="Encounter description"></textarea>
      </div>

      <div class="form-group">
        <label for="status">Status</label>
        <select id="status" [(ngModel)]="encounter.encounterStatus" name="status" class="form-control">
          <option value="Active">Active</option>
          <option value="Draft">Draft</option>
          <option value="Archieved">Archived</option>
        </select>
      </div>

      <!-- <div class="form-group">
        <label for="latitude">Latitude</label>
        <input type="number" id="latitude" [(ngModel)]="encounter.encounterLocation.latitude" name="latitude" required />
      </div>

      <div class="form-group">
        <label for="longitude">Longitude</label>
        <input type="number" id="longitude" [(ngModel)]="encounter.encounterLocation.longitude" name="longitude" required />
      </div> -->

      <div class="form-group">
        <label for="experiencePoints">Experience Points</label>
        <input type="number" id="experiencePoints" [(ngModel)]="encounter.experiencePoints" name="experiencePoints" required />
      </div>

      <div *ngIf="encounter.encounterType === 1" class="map-mode-buttons">
        <p>Current Map: {{ mapMode === 'encounterLocation' ? 'Encounter' : 'Image' }}</p>
        <button type="button" class="map-mode-buttons" (click)="setMapMode('encounterLocation')" [class.active]="mapMode === 'encounterLocation'">
          Set Encounter Location
        </button>
        <button type="button" class="map-mode-buttons" (click)="setMapMode('imageLocation')" [class.active]="mapMode === 'imageLocation'">
          Set Image Location
        </button>
      </div>

      <!-- Mapa za unos koordinata -->
      <div class="map-container">
        <xp-map (coordinatesSelected)="onCoordinatesSelected($event)" [encounters]="encounterCoordinates"></xp-map>
      </div>

      <button type="submit" class="cta-button" (click)="onSubmit()">
        {{ encounter.id ? 'Update Encounter' : 'Add Encounter' }}
      </button>
    </div>
  </form>
</div>
